<!DOCTYPE html>
<html lang="cn">

<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" /> -->
    <title>HPReader</title>
    <link rel="stylesheet" href="css_preimpl/toolbox.css">
    <style>
        body,
        html {
            height: 100%;
            width: 100%;
            overflow-y: hidden;
            margin: 0px;
            padding: 0px;
            background-color: whitesmoke;
            font-family: 'Times New Roman', Times, serif;
            font-size: 21px;
            text-align: justify;
        }

        h1,
        h3 {
            margin-top: 0px;
            font-family: 'Harry P', 'Times New Roman', Times, serif;
        }

        h1 {
            font-size: 56px;
        }

        h3 {
            font-size: 32px;
        }

        #pageWrapperDiv {
            z-index: 1;
            column-count: 2;
            column-gap: 80px;
            padding-left: 40px;
            padding-right: 40px;
            padding-top: 40px;
            overflow-y: hidden;
            height: 95%;
        }

        #pageWrapperDiv::-webkit-scrollbar {
            display: none;
        }



        .loadingBox {
            display: flex;
            height: 100%;
            z-index: 0;
            width: 100%;
            width: 100%;
            position: absolute;
        }

        .loader {
            margin: auto;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
        }

        /*LOADER-1*/

        .loader-1 .loader-outter {
            position: absolute;
            border: 4px solid cornflowerblue;
            border-left-color: transparent;
            border-bottom: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            -webkit-animation: loader-1-outter 1s cubic-bezier(.42, .61, .58, .41) infinite;
            animation: loader-1-outter 1s cubic-bezier(.42, .61, .58, .41) infinite;
        }

        .loader-1 .loader-inner {
            position: absolute;
            border: 4px solid cornflowerblue;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            left: calc(50% - 20px);
            top: calc(50% - 20px);
            border-right: 0;
            border-top-color: transparent;
            -webkit-animation: loader-1-inner 1s cubic-bezier(.42, .61, .58, .41) infinite;
            animation: loader-1-inner 1s cubic-bezier(.42, .61, .58, .41) infinite;
        }

        @keyframes loader-1-outter {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes loader-1-inner {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(-360deg);
                transform: rotate(-360deg);
            }
        }
    </style>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <script>
        let num2engword = ["ZERO", "ONE", "TWO", "THREE", "FOUR", "FIVE", "SIX", "SEVEN", "EIGHT", "NINE", "TEN", "ELEVEN", "TWELVE",
            "THIRTEEN", "FOURTEEN", "FIFTEEN", "SIXTEEN", "SEVENTEEN", "EIGHTEEN", "NINETEEN", "TWENTY", "TWENTY-ONE", "TWENTY-TWO",
            "TWENTY-THREE", "TWENTY-FOUR", "TWENTY-FIVE", "TWENTY-SIX", "TWENTY-SEVEN", "TWENTY-EIGHT", "TWENTY-NINE", "THIRTY",
            "THIRTY-ONE", "THIRTY-TWO", "THIRTY-THREE", "THIRTY-FOUR", "THIRTY-FIVE", "THIRTY-SIX", "THIRTY-SEVEN", "THIRTY-EIGHT",
            "THIRTY-NINE", "FORTY", "FORTY-ONE", "FORTY-TWO", "FORTY-THREE", "FORTY-FOUR", "FORTY-FIVE", "FORTY-SIX", "FORTY-SEVEN",
            "FORTY-EIGHT", "FORTY-NINE", "FIFTY"]

        // todo 词句翻译记录工具
        let toolBoxTool = {
            addListener() {

                let pageWrapperDiv = document.getElementById("pageWrapperDiv");
                pageWrapperDiv.addEventListener("selectstart", (event) => {
                    console.log("select start");
                });
                pageWrapperDiv.addEventListener("selectionchange", (event) => {
                    console.log("select change");
                });
                pageWrapperDiv.addEventListener("mousedown", (event) => {
                    console.log("mouse down");
                });
                pageWrapperDiv.addEventListener("mouseup", (event) => {
                    console.log("mouse up, selection: " + document.getSelection().toString());
                    
                });
                pageWrapperDiv.addEventListener("dblclick", (event) => {
                    console.log("double click");
                });
                document.addEventListener("selectionchange", (event) => {
                    console.log("selection change - document");
                });
            }
        };

        // 从数据加载页面
        let pageLoader = {
            // 数据加载完成后的监听器
            onLoadOver: null,
            // 设置监听器
            setOnLoadOverListener: listener => { pageLoader.onLoadOver = listener; },
            // 加载数据
            loadPage(data) {
                if (typeof (data) == String) data = JSON.parse(data);
                let pageWrapperDiv = document.getElementById("pageWrapperDiv");
                let create = (tag, innerText) => {
                    let ret = document.createElement(tag);
                    ret.innerText = innerText;
                    return ret;
                };
                pageWrapperDiv.appendChild(create("h1", data["title"]));
                let chapterIndex = 1;
                data["chapters"].forEach(chapter => {
                    // 新章节换页
                    if (chapterIndex > 1) {
                        let tmpH3 = create("h3", "CHAPTER " + num2engword[chapterIndex] + " " + chapter["title"]);
                        tmpH3.style.webkitColumnBreakBefore = "always";
                        pageWrapperDiv.appendChild(tmpH3);
                    } else {
                        pageWrapperDiv.appendChild(create("h3", "CHAPTER " + num2engword[chapterIndex] + " " + chapter["title"]));
                    }
                    chapter["lines"].forEach(line => { pageWrapperDiv.appendChild(create("p", line)); });
                    chapterIndex++;
                });
                if (this.onLoadOver != null) this.onLoadOver();
            }
        };

        // 换页
        let pageTurner = {
            // 翻页过程不能继续翻页
            turnStatus: {
                targetElement: null,
                targetLeft: 0,
                update(targetLeft) { this.targetLeft = targetLeft; }
            },
            nextPage() {
                let targetLeft = this.turnStatus.targetLeft + 1920;
                this.turnStatus.targetElement.scroll({ left: targetLeft, top: 0, behavior: "smooth" });
                this.turnStatus.update(targetLeft);
            },
            lastPage() {
                let targetLeft = this.turnStatus.targetLeft - 1920;
                if (targetLeft < 0) targetLeft = 0;
                this.turnStatus.targetElement.scroll({ left: targetLeft, top: 0, behavior: "smooth" });
                this.turnStatus.update(targetLeft);
            },
            home() {
                let targetLeft = 0;
                this.turnStatus.targetElement.scroll({ left: targetLeft, top: 0, behavior: "smooth" });
                this.turnStatus.update(targetLeft);
            },
            end() {
                let rightMostOffset = this.turnStatus.targetElement.children[this.turnStatus.targetElement.childElementCount - 1].offsetLeft;
                this.turnStatus.targetElement.scroll({ left: rightMostOffset + 1920, top: 0, behavior: "smooth" });
            },
            addListener(targetElement) {
                this.turnStatus.targetElement = targetElement;
                let checkNextPage = (event) => { return event.code == "Space" && !event.shiftKey || event.code == "ArrowDown" || event.code == "ArrowRight" || event.code == "PageDown"; };
                let checkLastPage = (event) => { return event.code == "Space" && event.shiftKey || event.code == "ArrowUp" || event.code == "ArrowLeft" || event.code == "PageUp"; };
                // 键盘翻页
                window.addEventListener("keydown", (event) => {
                    if (checkLastPage(event))
                        this.lastPage();
                    else if (checkNextPage(event))
                        this.nextPage();
                    else if (event.code == "Home")
                        this.home();
                    else if (event.code == "End")
                        this.end();

                });
                // 鼠标翻页
                window.addEventListener("mousewheel", (event) => {
                    if (event.deltaY > 0) this.nextPage();
                    else this.lastPage();
                });
            }
        };

        // 加载数据，注册盒子等监听器
        window.onload = function () {
            // 显示正在加载动画
            pageLoader.setOnLoadOverListener(() => { loadingBox.style.display = "none"; });
            $.getJSON("tmphp3.json", function success(data, textStatus, xhr) { pageLoader.loadPage(data); });
            pageTurner.addListener(document.getElementById("pageWrapperDiv"));
            toolBoxTool.addListener();
        };
    </script>
</head>

<body>

    <div id="wordbox">
        <div id="tranbox">
            garden<br>
            英 [ˈɡɑːrdn], 美 [ˈɡɑːdn]<br>
            n. 花园；菜园<br>
            vt. 栽培花木<br>
            vi. 从事园艺；在园中种植<br>
            n. (Garden)人名；(英、意、巴基)加登<br>
        </div>
        <hr>
        <div id="toolbox">
            <div id="copybox" onclick="wordTranslateTool.copy()">
                <div>
                    <img src="imgs/copy.png" title="复制单词释义">复制
                </div>
            </div>
            <div id="recordbox" onclick="wordTranslateTool.record()">
                <div>
                    <img src="imgs/record.png" title="记录单词释义">记录
                </div>
            </div>
        </div>
    </div>
    <div id="sentencebox">
        <div id="toolbox">
            <div id="copybox" onclick="sentenceTool.copy()">
                <div>
                    <img src="imgs/copy.png" title="复制所选内容">复制
                </div>
            </div>
            <div id="recordbox" onclick="sentenceTool.record()">
                <div>
                    <img src="imgs/record.png" title="记录所选内容">记录
                </div>
            </div>
        </div>
    </div>
    <div id="loadingBox">
        <div class="loader loader-1">
            <div class="loader-outer"></div>
            <div class="loader-inner"></div>
        </div>
    </div>
    <div id="pageWrapperDiv">
    </div>
</body>

</html>