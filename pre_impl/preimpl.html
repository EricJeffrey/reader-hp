<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PreImplementation</title>
    <style>
        html {
            height: 100%;
            width: 100%;
        }

        body {
            background-color: sandybrown;
            font-size: 18pt;
            font-family: 'Times New Roman', '等线', Times, serif;
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0px;
            overflow-y: hidden;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        #contentdiv {
            display: flex;
            width: 200%;
            height: 100%;
            overflow-y: hidden;
        }

        .pagediv {
            display: flex;
            float: left;
            width: 100%;
            height: 100%;
            overflow-y: hidden;
        }

        .leftpagediv,
        .rightpagediv {
            padding: 3%;
            width: 44%;
            height: fit-content;
        }
    </style>
    <script>
        let classname_pagediv = "pagediv";
        let classname_lpagediv = "leftpagediv";
        let classname_rpagediv = "rightpagediv";
        let classname_para = "para";

        function byid(id) {
            return document.getElementById(id);
        }
        function byclass(classname, index) {
            return document.getElementsByClassName(classname)[index];
        }
        function create(tagname, classname) {
            let tmp = document.createElement(tagname);
            tmp.className = classname;
            return tmp;
        }

        // 创建多个页，内容为data，data的每一行表示一个段落，data为span组成的字符串
        function createPages(data = "") {
            let linelist = data.split("\n");
            let paralist = [];
            // all <p>
            linelist.forEach(line => {
                let para = create("p", classname_para);
                para.innerHTML = line;
                paralist.push(para);
            });

            let contentdiv = byid("contentdiv");
            let widthinitcontentdiv = 0;
            let widthcurcontentdiv = 0;
            let indexpara = 0;
            while (indexpara < paralist.length) {
                // pagediv
                let pagediv = create("div", classname_pagediv);
                contentdiv.appendChild(pagediv);
                widthcurcontentdiv += 1;
                contentdiv.style.width = (widthinitcontentdiv + widthcurcontentdiv) * 100 + "%";
                // left/right-page-div
                let targetheight = pagediv.clientHeight;
                let leftpagediv = create("div", classname_lpagediv);
                let rightpagediv = create("div", classname_rpagediv);
                pagediv.appendChild(leftpagediv);
                pagediv.appendChild(rightpagediv);
                // insert
                let insertpara2lrpage = (paralist, indexpara, lrpagediv, targetheight) => {
                    while (indexpara < paralist.length) {
                        lrpagediv.appendChild(paralist[indexpara]);
                        if (lrpagediv.clientHeight > targetheight) {
                            lrpagediv.removeChild(lrpagediv.lastElementChild);
                            break;
                        }
                        indexpara += 1;
                    }
                    return indexpara;
                };
                indexpara = insertpara2lrpage(paralist, indexpara, leftpagediv, targetheight);
                indexpara = insertpara2lrpage(paralist, indexpara, rightpagediv, targetheight);
            }
        }

        class PageTurner {
            registerEvent() {
                window.addEventListener("keydown", (event) => {
                    if (event.code == "PageUp") this.prevPage();
                    if (event.code == "PageDown") this.nextPage();
                });
                window.addEventListener("keypress", (event) => {
                    if (event.code == "Space" && event.shiftKey) this.prevPage();
                    if (event.code == "Space" && !event.shiftKey) this.nextPage();
                });
                let validClickWidth = 400;
                window.addEventListener("click", (event) => {
                    if (event.clientX <= validClickWidth) this.prevPage();
                    if (event.clientX >= document.body.clientWidth - validClickWidth) this.nextPage();
                });
                window.addEventListener("wheel", (event) => {
                    if (event.deltaY > 0) this.nextPage();
                    if (event.deltaY < 0) this.prevPage();
                })
            }
            prevPage() {
                let attrPageCurContDiv = "page-current";
                let contentdiv = byid("contentdiv");
                let currentPage = Number(contentdiv.getAttribute(attrPageCurContDiv));
                if (currentPage > 0) {
                    contentdiv.setAttribute(attrPageCurContDiv, currentPage - 1);
                    window.scroll({ top: 0, left: contentdiv.children[currentPage - 1].offsetLeft, behavior: "smooth" });
                }
            }
            nextPage() {
                let attrPageCurContDiv = "page-current";
                let contentdiv = byid("contentdiv");
                let currentPage = Number(contentdiv.getAttribute(attrPageCurContDiv));
                if (currentPage < contentdiv.childElementCount - 1) {
                    contentdiv.setAttribute(attrPageCurContDiv, currentPage + 1);
                    window.scroll({ top: 0, left: contentdiv.children[currentPage + 1].offsetLeft, behavior: "smooth" });
                }
            }
        };

        // 测试函数
        var test = {
            // 测试指定className之后元素是否具有高度 -> 将元素加入到dom之后才会开始计算高度
            testElementHeight: function () {
                let div = document.createElement("div");
                div.className = classname_pagediv;
                byid("contentdiv").appendChild(div);
                let tmpp = document.createElement("p");
                tmpp.innerText = "11111111111111111111111111111111111111";
                div.appendChild(tmpp);
                console.log("body-height: " + document.body.clientHeight);
                console.log("div-height: " + div.clientHeight);
                console.log("pagediv-height: " + byclass("pagediv", 0).clientHeight);
                console.log("leftpagediv-height: " + byclass(classname_lpagediv, 0).clientHeight);
                console.log("leftpagediv-padding: " + byclass(classname_lpagediv, 0).style.padding);

            },
            testWheelEvent: function () {
                window.addEventListener("wheel", (event) => {
                    console.log(event);
                });
            },
            testClickOnWindowPos: function () {
                window.addEventListener("click", (event) => {
                    console.log(event);
                });
            },
            testPageUpDown: function () {
                window.addEventListener("keypress", (event) => {
                    console.log(event);
                });
                window.addEventListener("keydown", (event) => {
                    console.log(event);
                });
            }
        }

        window.onload = () => {
            console.log("I am Executed");
            let data = "出师表\n诸葛亮\n先帝创业未半而中道崩殂\n今天下三分\n益州疲弊\n此诚危急存亡之秋也\n然侍卫之臣不懈于内\n忠志之士忘身于外者\n盖追先帝之殊遇\n欲报之于陛下也\n诚宜开张圣听\n以光先帝遗德\n恢弘志士之气\n不宜妄自菲薄\n引喻失义\n以塞忠谏之路也\n宫中府中\n俱为一体\n陟罚臧否\n不宜异同\n若有作奸犯科及为忠善者\n宜付有司论其刑赏\n以昭陛下平明之理\n不宜偏私\n使内外异法也\n侍中侍郎郭攸之、费祎、董允等\n此皆良实\n志虑忠纯\n是以先帝简拔以遗陛下\n愚以为宫中之事\n事无大小\n悉以咨之\n然后施行\n必能裨补阙漏\n有所广益\n将军向宠\n性行淑均\n晓畅军事\n试用于昔日\n先帝称之曰能\n是以众议举宠为督\n愚以为营中之事\n悉以咨之\n必能使行阵和睦\n优劣得所\n亲贤臣\n远小人\n此先汉所以兴隆也\n亲小人\n远贤臣\n此后汉所以倾颓也\n先帝在时\n每与臣论此事\n未尝不叹息痛恨于桓灵也\n侍中尚书、长史、参军\n此悉贞良死节之臣\n愿陛下亲之信之\n则汉室之隆\n可计日而待也\n臣本布衣\n躬耕于南阳\n苟全性命于乱世\n不求闻达于诸侯\n先帝不以臣卑鄙\n猥自枉屈\n三顾臣于草庐之中\n咨臣以当世之事\n由是感激\n遂许先帝以驱驰\n后值倾覆\n受任于败军之际\n奉命于危难之间\n尔来二十有一年矣\n先帝知臣谨慎\n故临崩寄臣以大事也\n受命以来\n夙夜忧叹\n恐托付不效\n以伤先帝之明\n故五月渡泸\n深入不毛\n今南方已定\n兵甲已足\n当奖率三军\n北定中原\n庶竭驽钝\n攘除奸凶\n兴复汉室\n还于旧都\n此臣所以报先帝而忠陛下之职分也\n至于斟酌损益\n进尽忠言\n则攸之祎、允之任也\n愿陛下托臣以讨贼兴复之效\n不效\n则治臣之罪\n以告先帝之灵\n若无兴德之言\n则责攸之祎、允等之慢\n以彰其咎\n陛下亦宜自谋\n以咨诹善道\n察纳雅言\n深追先帝遗诏\n臣不胜受恩感激\n今当远离\n临表涕零\n不知所言";
            createPages(data);
            let pageTurner = new PageTurner();
            pageTurner.registerEvent();
        }
    </script>
</head>

<body>
    <div id="contentdiv" page-current="0">
    </div>
</body>

</html>